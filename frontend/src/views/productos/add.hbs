<link rel="stylesheet" href="/styles/productos.css">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Productos</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card p-4">
        <div class="card-body">
          <h3 class="text-center mb-4">Registro de Producto</h3>
          <form>
            <div class="mb-3">
              <label for="codigo_producto" class="form-label">Código Producto</label>
              <input type="text" id="codigo_producto" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="nombre" class="form-label">Nombre</label>
              <input type="text" id="nombre" class="form-control" required>
            </div>
            <div class="mb-3">
              <label for="sector" class="form-label">Sector</label>
              <select id="sector" class="form-select" required>
                <option value="" disabled selected>Seleccione un sector</option>
                <% if (sectores && sectores.length> 0) { %>
                  <% sectores.forEach(sector=> { %>
                    <option value="<%= sector %>">
                      <%= sector %>
                    </option>
                    <% }) %>
                      <% } else { %>
                        <option value="" disabled>No hay sectores disponibles</option>
                        <% } %>
              </select>
              <label for="codigo_proveedor" class="form-label">Código Proveedor</label>
              <select id="codigo_proveedor" class="form-select" required>
                <option value="" disabled selected>Seleccione un proveedor</option>
                <% proveedores.forEach(proveedor=> { %>
                  <option value="<%= proveedor.Cod_Proveedor %>">
                    <%= proveedor.Nombre %>
                  </option>
                  <% }) %>
              </select>
            </div>
            <div class="mb-3">
              <label for="precio_compra" class="form-label">Precio Compra</label>
              <input type="number" id="precio_compra" class="form-control" step="0.01" required>
            </div>
            <div class="mb-3">
              <label for="cantidad" class="form-label">Cantidad</label>
              <input type="number" id="cantidad" class="form-control" required>
              <div class="mb-3">
                <label for="marca" class="form-label">Marca</label>
                <input type="text" id="marca" class="form-control" required>
              </div>
              <div class="mb-3">
                <label for="fecha_entrada" class="form-label">Fecha Entrada</label>
                <input type="date" id="fecha_entrada" class="form-control" disabled>
              </div>
              <div class="mb-3">
                <label for="fecha_vencimiento" class="form-label">Fecha Vencimiento</label>
                <input type="date" id="fecha_vencimiento" class="form-control" required>
              </div>
              <div class="d-flex justify-content-between">
                <button class="btn btn-primary btn-custom w-45" type="submit">Ingresar</button>
                <button class="btn btn-warning btn-custom w-45" type="button">Modificar</button>
                <button class="btn btn-danger btn-custom w-45" type="button">Eliminar</button>
              </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const sectorSelect = document.getElementById("sector");

    // Hacer una solicitud AJAX para obtener los proveedores
    fetch("http://localhost:4000/proveedores/api/proveedores")
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Obtener una lista única de sectores
          const sectoresUnicos = [...new Set(data.data.map(proveedor => proveedor.Sector))];

          // Limpiar opciones previas y agregar una por defecto
          sectorSelect.innerHTML = '<option value="" disabled selected>Seleccione un sector</option>';

          // Agregar los sectores únicos al <select>
          sectoresUnicos.forEach(sector => {
            const option = document.createElement("option");
            option.value = sector;
            option.textContent = sector;
            sectorSelect.appendChild(option);
          });
        } else {
          console.error("❌ No se pudieron cargar los sectores");
        }
      })
      .catch(error => console.error("❌ Error en la solicitud:", error));
  });

  document.getElementById("sector").addEventListener("change", function () {
    const sectorSeleccionado = this.value;
    const proveedoresSelect = document.getElementById("codigo_proveedor");

    // Limpiar las opciones previas en el select de proveedores
    proveedoresSelect.innerHTML = '<option value="" disabled selected>Seleccione un proveedor</option>';

    fetch("http://localhost:4000/proveedores/api/proveedores")
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Filtrar los proveedores que pertenecen al sector seleccionado
          const proveedoresFiltrados = data.data.filter(proveedor => proveedor.Sector === sectorSeleccionado);

          // Agregar los proveedores al select
          proveedoresFiltrados.forEach(proveedor => {
            const option = document.createElement("option");
            option.value = proveedor.Cod_Proveedor;
            option.textContent = proveedor.Nombre + " " + proveedor.Apellido;
            proveedoresSelect.appendChild(option);
          });

          // Si no hay proveedores en ese sector, mostrar mensaje en consola
          if (proveedoresFiltrados.length === 0) {
            console.warn("⚠️ No hay proveedores para el sector:", sectorSeleccionado);
          }
        } else {
          console.error("❌ No se pudieron cargar los proveedores");
        }
      })
      .catch(error => console.error("❌ Error en la solicitud:", error));
  });

  // Obtener la fecha actual del sistema
  let fechaActual = new Date();

  // Obtener el año, mes y día de la fecha actual
  let anio = fechaActual.getFullYear();
  let mes = ("0" + (fechaActual.getMonth() + 1)).slice(-2); // Asegura que el mes esté en dos dígitos
  let dia = ("0" + fechaActual.getDate()).slice(-2); // Asegura que el día esté en dos dígitos

  // Formatear la fecha como YYYY-MM-DD
  let fechaFormateada = ${anio}-${mes}-${dia};

  // Asignar la fecha al campo de entrada
  document.getElementById('fecha_entrada').value = fechaFormateada;

  const navbar = document.querySelector(".navbar");

  window.addEventListener("scroll", function () {
    if (window.scrollY === 0) {
      // Si está en la parte superior, mostramos la navbar
      navbar.style.top = "0";
      navbar.style.opacity = "1";
    } else {
      // Si baja, ocultamos la navbar
      navbar.style.top = "-80px"; // Ajusta según el tamaño de la navbar
      navbar.style.opacity = "0";
    }
  });
</script>
